{"version":3,"sources":["../../src/payment-identifier/types.ts","../../src/payment-identifier/schema.ts","../../src/payment-identifier/utils.ts","../../src/payment-identifier/validation.ts","../../src/payment-identifier/client.ts","../../src/payment-identifier/resourceServer.ts"],"sourcesContent":["/**\n * Type definitions for the Payment-Identifier Extension\n *\n * Enables clients to provide an idempotency key that resource servers\n * can use for deduplication of payment requests.\n */\n\n/**\n * Extension identifier constant for the payment-identifier extension\n */\nexport const PAYMENT_IDENTIFIER = \"payment-identifier\";\n\n/**\n * Minimum length for payment identifier\n */\nexport const PAYMENT_ID_MIN_LENGTH = 16;\n\n/**\n * Maximum length for payment identifier\n */\nexport const PAYMENT_ID_MAX_LENGTH = 128;\n\n/**\n * Pattern for valid payment identifier characters (alphanumeric, hyphens, underscores)\n */\nexport const PAYMENT_ID_PATTERN = /^[a-zA-Z0-9_-]+$/;\n\n/**\n * Payment identifier info containing the required flag and client-provided ID\n */\nexport interface PaymentIdentifierInfo {\n  /**\n   * Whether the server requires clients to include a payment identifier.\n   * When true, clients must provide an `id` or receive a 400 Bad Request.\n   */\n  required: boolean;\n\n  /**\n   * Client-provided unique identifier for idempotency.\n   * Must be 16-128 characters, alphanumeric with hyphens and underscores allowed.\n   */\n  id?: string;\n}\n\n/**\n * Payment identifier extension with info and schema.\n *\n * Used both for server-side declarations (info without id) and\n * client-side payloads (info with id).\n */\nexport interface PaymentIdentifierExtension {\n  /**\n   * The payment identifier info.\n   * Server declarations have required only, clients add the id.\n   */\n  info: PaymentIdentifierInfo;\n\n  /**\n   * JSON Schema validating the info structure\n   */\n  schema: PaymentIdentifierSchema;\n}\n\n/**\n * JSON Schema type for the payment-identifier extension\n */\nexport interface PaymentIdentifierSchema {\n  $schema: \"https://json-schema.org/draft/2020-12/schema\";\n  type: \"object\";\n  properties: {\n    required: {\n      type: \"boolean\";\n    };\n    id: {\n      type: \"string\";\n      minLength: number;\n      maxLength: number;\n      pattern: string;\n    };\n  };\n  required: [\"required\"];\n}\n","/**\n * JSON Schema definitions for the Payment-Identifier Extension\n */\n\nimport type { PaymentIdentifierSchema } from \"./types\";\nimport { PAYMENT_ID_MIN_LENGTH, PAYMENT_ID_MAX_LENGTH } from \"./types\";\n\n/**\n * JSON Schema for validating payment identifier info.\n * Compliant with JSON Schema Draft 2020-12.\n */\nexport const paymentIdentifierSchema: PaymentIdentifierSchema = {\n  $schema: \"https://json-schema.org/draft/2020-12/schema\",\n  type: \"object\",\n  properties: {\n    required: {\n      type: \"boolean\",\n    },\n    id: {\n      type: \"string\",\n      minLength: PAYMENT_ID_MIN_LENGTH,\n      maxLength: PAYMENT_ID_MAX_LENGTH,\n      pattern: \"^[a-zA-Z0-9_-]+$\",\n    },\n  },\n  required: [\"required\"],\n};\n","/**\n * Utility functions for the Payment-Identifier Extension\n */\n\nimport { PAYMENT_ID_MIN_LENGTH, PAYMENT_ID_MAX_LENGTH, PAYMENT_ID_PATTERN } from \"./types\";\n\n/**\n * Generates a unique payment identifier.\n *\n * @param prefix - Optional prefix for the ID (e.g., \"pay_\"). Defaults to \"pay_\".\n * @returns A unique payment identifier string\n *\n * @example\n * ```typescript\n * // With default prefix\n * const id = generatePaymentId(); // \"pay_7d5d747be160e280504c099d984bcfe0\"\n *\n * // With custom prefix\n * const id = generatePaymentId(\"txn_\"); // \"txn_7d5d747be160e280504c099d984bcfe0\"\n *\n * // Without prefix\n * const id = generatePaymentId(\"\"); // \"7d5d747be160e280504c099d984bcfe0\"\n * ```\n */\nexport function generatePaymentId(prefix: string = \"pay_\"): string {\n  // Generate UUID v4 without hyphens (32 hex chars)\n  const uuid = crypto.randomUUID().replace(/-/g, \"\");\n  return `${prefix}${uuid}`;\n}\n\n/**\n * Validates that a payment ID meets the format requirements.\n *\n * @param id - The payment ID to validate\n * @returns True if the ID is valid, false otherwise\n *\n * @example\n * ```typescript\n * isValidPaymentId(\"pay_7d5d747be160e280\"); // true (exactly 16 chars after prefix removal check)\n * isValidPaymentId(\"abc\"); // false (too short)\n * isValidPaymentId(\"pay_abc!@#\"); // false (invalid characters)\n * ```\n */\nexport function isValidPaymentId(id: string): boolean {\n  if (typeof id !== \"string\") {\n    return false;\n  }\n\n  if (id.length < PAYMENT_ID_MIN_LENGTH || id.length > PAYMENT_ID_MAX_LENGTH) {\n    return false;\n  }\n\n  return PAYMENT_ID_PATTERN.test(id);\n}\n","/**\n * Validation and extraction utilities for the Payment-Identifier Extension\n */\n\nimport Ajv from \"ajv/dist/2020.js\";\nimport type { PaymentPayload } from \"@x402/core/types\";\nimport type { PaymentIdentifierExtension, PaymentIdentifierInfo } from \"./types\";\nimport { PAYMENT_IDENTIFIER } from \"./types\";\nimport { paymentIdentifierSchema } from \"./schema\";\nimport { isValidPaymentId } from \"./utils\";\n\n/**\n * Type guard to check if an object is a valid payment-identifier extension structure.\n *\n * This checks for the basic structure (info object with required boolean),\n * but does not validate the id format if present.\n *\n * @param extension - The object to check\n * @returns True if the object has the expected payment-identifier extension structure\n *\n * @example\n * ```typescript\n * if (isPaymentIdentifierExtension(extensions[\"payment-identifier\"])) {\n *   // TypeScript knows this is PaymentIdentifierExtension\n *   console.log(extension.info.required);\n * }\n * ```\n */\nexport function isPaymentIdentifierExtension(\n  extension: unknown,\n): extension is PaymentIdentifierExtension {\n  if (!extension || typeof extension !== \"object\") {\n    return false;\n  }\n\n  const ext = extension as Partial<PaymentIdentifierExtension>;\n\n  if (!ext.info || typeof ext.info !== \"object\") {\n    return false;\n  }\n\n  const info = ext.info as Partial<PaymentIdentifierInfo>;\n\n  // Must have required boolean\n  if (typeof info.required !== \"boolean\") {\n    return false;\n  }\n\n  return true;\n}\n\n/**\n * Result of payment identifier validation\n */\nexport interface PaymentIdentifierValidationResult {\n  /**\n   * Whether the payment identifier is valid\n   */\n  valid: boolean;\n\n  /**\n   * Error messages if validation failed\n   */\n  errors?: string[];\n}\n\n/**\n * Validates a payment-identifier extension object.\n *\n * Checks both the structure (using JSON Schema) and the ID format.\n *\n * @param extension - The extension object to validate\n * @returns Validation result with errors if invalid\n *\n * @example\n * ```typescript\n * const result = validatePaymentIdentifier(paymentPayload.extensions?.[\"payment-identifier\"]);\n * if (!result.valid) {\n *   console.error(\"Invalid payment identifier:\", result.errors);\n * }\n * ```\n */\nexport function validatePaymentIdentifier(extension: unknown): PaymentIdentifierValidationResult {\n  if (!extension || typeof extension !== \"object\") {\n    return {\n      valid: false,\n      errors: [\"Extension must be an object\"],\n    };\n  }\n\n  const ext = extension as Partial<PaymentIdentifierExtension>;\n\n  // Check info exists\n  if (!ext.info || typeof ext.info !== \"object\") {\n    return {\n      valid: false,\n      errors: [\"Extension must have an 'info' property\"],\n    };\n  }\n\n  const info = ext.info as Partial<PaymentIdentifierInfo>;\n\n  // Check required field exists and is a boolean\n  if (typeof info.required !== \"boolean\") {\n    return {\n      valid: false,\n      errors: [\"Extension info must have a 'required' boolean property\"],\n    };\n  }\n\n  // Check id exists and is a string (if provided)\n  if (info.id !== undefined && typeof info.id !== \"string\") {\n    return {\n      valid: false,\n      errors: [\"Extension info 'id' must be a string if provided\"],\n    };\n  }\n\n  // Validate ID format if provided\n  if (info.id !== undefined && !isValidPaymentId(info.id)) {\n    return {\n      valid: false,\n      errors: [\n        `Invalid payment ID format. ID must be 16-128 characters and contain only alphanumeric characters, hyphens, and underscores.`,\n      ],\n    };\n  }\n\n  // If schema is provided, validate against it\n  if (ext.schema) {\n    try {\n      const ajv = new Ajv({ strict: false, allErrors: true });\n      const validate = ajv.compile(ext.schema);\n      const valid = validate(ext.info);\n\n      if (!valid && validate.errors) {\n        const errors = validate.errors?.map(err => {\n          const path = err.instancePath || \"(root)\";\n          return `${path}: ${err.message}`;\n        }) || [\"Unknown validation error\"];\n\n        return { valid: false, errors };\n      }\n    } catch (error) {\n      return {\n        valid: false,\n        errors: [\n          `Schema validation failed: ${error instanceof Error ? error.message : String(error)}`,\n        ],\n      };\n    }\n  }\n\n  return { valid: true };\n}\n\n/**\n * Extracts the payment identifier from a PaymentPayload.\n *\n * @param paymentPayload - The payment payload to extract from\n * @param validate - Whether to validate the ID before returning (default: true)\n * @returns The payment ID string, or null if not present or invalid\n *\n * @example\n * ```typescript\n * const id = extractPaymentIdentifier(paymentPayload);\n * if (id) {\n *   // Use for idempotency lookup\n *   const cached = await idempotencyStore.get(id);\n * }\n * ```\n */\nexport function extractPaymentIdentifier(\n  paymentPayload: PaymentPayload,\n  validate: boolean = true,\n): string | null {\n  if (!paymentPayload.extensions) {\n    return null;\n  }\n\n  const extension = paymentPayload.extensions[PAYMENT_IDENTIFIER];\n\n  if (!extension || typeof extension !== \"object\") {\n    return null;\n  }\n\n  const ext = extension as Partial<PaymentIdentifierExtension>;\n\n  if (!ext.info || typeof ext.info !== \"object\") {\n    return null;\n  }\n\n  const info = ext.info as Partial<PaymentIdentifierInfo>;\n\n  if (typeof info.id !== \"string\") {\n    return null;\n  }\n\n  if (validate && !isValidPaymentId(info.id)) {\n    return null;\n  }\n\n  return info.id;\n}\n\n/**\n * Extracts and validates the payment identifier from a PaymentPayload.\n *\n * @param paymentPayload - The payment payload to extract from\n * @returns Object with the ID and validation result\n *\n * @example\n * ```typescript\n * const { id, validation } = extractAndValidatePaymentIdentifier(paymentPayload);\n * if (!validation.valid) {\n *   return res.status(400).json({ error: validation.errors });\n * }\n * if (id) {\n *   // Use for idempotency\n * }\n * ```\n */\nexport function extractAndValidatePaymentIdentifier(paymentPayload: PaymentPayload): {\n  id: string | null;\n  validation: PaymentIdentifierValidationResult;\n} {\n  if (!paymentPayload.extensions) {\n    return { id: null, validation: { valid: true } };\n  }\n\n  const extension = paymentPayload.extensions[PAYMENT_IDENTIFIER];\n\n  if (!extension) {\n    return { id: null, validation: { valid: true } };\n  }\n\n  const validation = validatePaymentIdentifier(extension);\n\n  if (!validation.valid) {\n    return { id: null, validation };\n  }\n\n  const ext = extension as PaymentIdentifierExtension;\n  return { id: ext.info.id ?? null, validation: { valid: true } };\n}\n\n/**\n * Checks if a PaymentPayload contains a payment-identifier extension.\n *\n * @param paymentPayload - The payment payload to check\n * @returns True if the extension is present\n */\nexport function hasPaymentIdentifier(paymentPayload: PaymentPayload): boolean {\n  return !!(paymentPayload.extensions && paymentPayload.extensions[PAYMENT_IDENTIFIER]);\n}\n\n/**\n * Checks if the server requires a payment identifier based on the extension info.\n *\n * @param extension - The payment-identifier extension from PaymentRequired or PaymentPayload\n * @returns True if the server requires a payment identifier\n */\nexport function isPaymentIdentifierRequired(extension: unknown): boolean {\n  if (!extension || typeof extension !== \"object\") {\n    return false;\n  }\n\n  const ext = extension as Partial<PaymentIdentifierExtension>;\n\n  if (!ext.info || typeof ext.info !== \"object\") {\n    return false;\n  }\n\n  return (ext.info as Partial<PaymentIdentifierInfo>).required === true;\n}\n\n/**\n * Validates that a payment identifier is provided when required.\n *\n * Use this to check if a client's PaymentPayload satisfies the server's requirement.\n *\n * @param paymentPayload - The client's payment payload\n * @param serverRequired - Whether the server requires a payment identifier (from PaymentRequired)\n * @returns Validation result - invalid if required but not provided\n *\n * @example\n * ```typescript\n * const serverExtension = paymentRequired.extensions?.[\"payment-identifier\"];\n * const serverRequired = isPaymentIdentifierRequired(serverExtension);\n * const result = validatePaymentIdentifierRequirement(paymentPayload, serverRequired);\n * if (!result.valid) {\n *   return res.status(400).json({ error: result.errors });\n * }\n * ```\n */\nexport function validatePaymentIdentifierRequirement(\n  paymentPayload: PaymentPayload,\n  serverRequired: boolean,\n): PaymentIdentifierValidationResult {\n  if (!serverRequired) {\n    return { valid: true };\n  }\n\n  const id = extractPaymentIdentifier(paymentPayload, false);\n\n  if (!id) {\n    return {\n      valid: false,\n      errors: [\"Server requires a payment identifier but none was provided\"],\n    };\n  }\n\n  // Validate the ID format\n  if (!isValidPaymentId(id)) {\n    return {\n      valid: false,\n      errors: [\n        `Invalid payment ID format. ID must be 16-128 characters and contain only alphanumeric characters, hyphens, and underscores.`,\n      ],\n    };\n  }\n\n  return { valid: true };\n}\n\nexport { paymentIdentifierSchema };\n","/**\n * Client-side utilities for the Payment-Identifier Extension\n */\n\nimport { PAYMENT_IDENTIFIER } from \"./types\";\nimport { generatePaymentId, isValidPaymentId } from \"./utils\";\nimport { isPaymentIdentifierExtension } from \"./validation\";\n\n/**\n * Appends a payment identifier to the extensions object if the server declared support.\n *\n * This function reads the server's `payment-identifier` declaration from the extensions,\n * and appends the client's ID to it. If the extension is not present (server didn't declare it),\n * the extensions are returned unchanged.\n *\n * @param extensions - The extensions object from PaymentRequired (will be modified in place)\n * @param id - Optional custom payment ID. If not provided, a new ID will be generated.\n * @returns The modified extensions object (same reference as input)\n * @throws Error if the provided ID is invalid\n *\n * @example\n * ```typescript\n * import { appendPaymentIdentifierToExtensions } from '@x402/extensions/payment-identifier';\n *\n * // Get extensions from server's PaymentRequired response\n * const extensions = paymentRequired.extensions ?? {};\n *\n * // Append a generated ID (only if server declared payment-identifier)\n * appendPaymentIdentifierToExtensions(extensions);\n *\n * // Or use a custom ID\n * appendPaymentIdentifierToExtensions(extensions, \"pay_my_custom_id_12345\");\n *\n * // Include in PaymentPayload\n * const paymentPayload = {\n *   x402Version: 2,\n *   resource: paymentRequired.resource,\n *   accepted: selectedPaymentOption,\n *   payload: { ... },\n *   extensions\n * };\n * ```\n */\nexport function appendPaymentIdentifierToExtensions(\n  extensions: Record<string, unknown>,\n  id?: string,\n): Record<string, unknown> {\n  const extension = extensions[PAYMENT_IDENTIFIER];\n\n  // Only append if the server declared this extension with valid structure\n  if (!isPaymentIdentifierExtension(extension)) {\n    return extensions;\n  }\n\n  const paymentId = id ?? generatePaymentId();\n\n  if (!isValidPaymentId(paymentId)) {\n    throw new Error(\n      `Invalid payment ID: \"${paymentId}\". ` +\n        `ID must be 16-128 characters and contain only alphanumeric characters, hyphens, and underscores.`,\n    );\n  }\n\n  // Append the ID to the existing extension info\n  extension.info.id = paymentId;\n\n  return extensions;\n}\n","/**\n * Resource Server utilities for the Payment-Identifier Extension\n */\n\nimport type { ResourceServerExtension } from \"@x402/core/types\";\nimport type { PaymentIdentifierExtension } from \"./types\";\nimport { PAYMENT_IDENTIFIER } from \"./types\";\nimport { paymentIdentifierSchema } from \"./schema\";\n\n/**\n * Declares the payment-identifier extension for inclusion in PaymentRequired.extensions.\n *\n * Resource servers call this function to advertise support for payment identifiers.\n * The declaration indicates whether a payment identifier is required and includes\n * the schema that clients must follow.\n *\n * @param required - Whether clients must provide a payment identifier. Defaults to false.\n * @returns A PaymentIdentifierExtension object ready for PaymentRequired.extensions\n *\n * @example\n * ```typescript\n * import { declarePaymentIdentifierExtension, PAYMENT_IDENTIFIER } from '@x402/extensions/payment-identifier';\n *\n * // Include in PaymentRequired response (optional identifier)\n * const paymentRequired = {\n *   x402Version: 2,\n *   resource: { ... },\n *   accepts: [ ... ],\n *   extensions: {\n *     [PAYMENT_IDENTIFIER]: declarePaymentIdentifierExtension()\n *   }\n * };\n *\n * // Require payment identifier\n * const paymentRequiredStrict = {\n *   x402Version: 2,\n *   resource: { ... },\n *   accepts: [ ... ],\n *   extensions: {\n *     [PAYMENT_IDENTIFIER]: declarePaymentIdentifierExtension(true)\n *   }\n * };\n * ```\n */\nexport function declarePaymentIdentifierExtension(\n  required: boolean = false,\n): PaymentIdentifierExtension {\n  return {\n    info: { required },\n    schema: paymentIdentifierSchema,\n  };\n}\n\n/**\n * ResourceServerExtension implementation for payment-identifier.\n *\n * This extension doesn't require any enrichment hooks since the declaration\n * is static. It's provided for consistency with other extensions and for\n * potential future use with the extension registration system.\n *\n * @example\n * ```typescript\n * import { paymentIdentifierResourceServerExtension } from '@x402/extensions/payment-identifier';\n *\n * resourceServer.registerExtension(paymentIdentifierResourceServerExtension);\n * ```\n */\nexport const paymentIdentifierResourceServerExtension: ResourceServerExtension = {\n  key: PAYMENT_IDENTIFIER,\n\n  // No enrichment needed - the declaration is static\n  // Future hooks for idempotency could be added here if needed\n};\n"],"mappings":"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","names":[]}